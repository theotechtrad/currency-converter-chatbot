<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Converter Chatbot Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        #chat-container {
            background-color: #fff;
            width: 100%;
            max-width: 500px;
            height: 90vh;
            max-height: 750px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #header {
            background-color: #4CAF50;
            padding: 15px;
            text-align: center;
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            flex-shrink: 0;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background-color: #f0f0f0;
            flex-shrink: 0;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: bold;
            font-size: 0.85em;
            transition: all 0.3s;
        }

        .tab:hover {
            background-color: #e0e0e0;
        }

        .tab.active {
            background-color: #fff;
            border-bottom: 3px solid #4CAF50;
            color: #4CAF50;
        }

        .tab-content {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        /* Current Tab */
        #currency-symbols-container {
            padding: 15px 10px;
            background-color: #fff;
            flex-shrink: 0;
        }

        .currency-row {
            display: flex;
            justify-content: space-around;
            margin-bottom: 8px;
        }

        .symbol {
            font-size: 2em;
            animation: float 3s infinite;
            opacity: 0.8;
        }

        .large-symbol {
            font-size: 3em;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        #chat-box {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #fafafa;
            min-height: 150px;
        }

        .message {
            margin: 10px 0;
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
            clear: both;
            display: inline-block;
        }

        .user-message {
            background-color: #4CAF50;
            color: white;
            float: right;
        }

        .bot-message {
            background-color: #e0e0e0;
            color: black;
            float: left;
        }

        /* Historical Tab */
        .date-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
            width: 100%;
            margin-bottom: 10px;
        }

        .result-box {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .result-box h3 {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .result-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        /* Prediction Tab */
        .prediction-box {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .prediction-box h3 {
            color: #2196F3;
            margin-bottom: 10px;
        }

        .trend-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            margin-top: 10px;
            font-weight: bold;
        }

        .trend-up {
            background-color: #c8e6c9;
            color: #2e7d32;
        }

        .trend-down {
            background-color: #ffcdd2;
            color: #c62828;
        }

        .disclaimer {
            font-size: 0.75em;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }

        /* Input containers */
        #input-container, .feature-container {
            display: flex;
            padding: 10px;
            border-top: 1px solid #ddd;
            background-color: #fff;
            gap: 10px;
            flex-shrink: 0;
            flex-wrap: wrap;
        }

        #input-box {
            flex: 1;
            padding: 10px;
            font-size: 1em;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }

        .btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn:hover {
            background-color: #45a049;
        }

        .btn-secondary {
            background-color: #2196F3;
        }

        .btn-secondary:hover {
            background-color: #1976D2;
        }

        #conversion-container {
            padding: 12px;
            background-color: #e0f7e9;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            justify-content: center;
            flex-shrink: 0;
        }

        #amount, .days-input {
            width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
        }

        #from-currency,
        #to-currency,
        .currency-select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
        }

        #conversion-result {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: #333;
            background-color: #f0f0f0;
            flex-shrink: 0;
        }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            #chat-container {
                max-height: 85vh;
                height: 85vh;
            }

            #header {
                font-size: 1.1em;
                padding: 12px;
            }

            .tab {
                font-size: 0.75em;
                padding: 10px 5px;
            }

            .symbol {
                font-size: 1.5em;
            }

            .large-symbol {
                font-size: 2.2em;
            }

            #amount, .days-input {
                width: 70px;
            }

            .message {
                font-size: 0.9em;
                max-width: 85%;
            }
        }
    </style>
</head>
<body>

<div id="chat-container">
    <div id="header">üí¨ Currency Converter Chatbot</div>

    <!-- Tabs -->
    <div class="tabs">
        <div class="tab active" onclick="switchTab('current')">üí± Current</div>
        <div class="tab" onclick="switchTab('historical')">üìä History</div>
        <div class="tab" onclick="switchTab('prediction')">üîÆ Predict</div>
    </div>

    <!-- Current Tab -->
    <div id="current-tab" class="tab-content active">
        <div id="currency-symbols-container">
            <div class="currency-row">
                <div class="symbol large-symbol">üíµ</div>
                <div class="symbol large-symbol">üí∂</div>
                <div class="symbol large-symbol">üí∑</div>
                <div class="symbol large-symbol">üí¥</div>
            </div>
            <div class="currency-row">
                <div class="symbol">‚Çπ</div>
                <div class="symbol">¬•</div>
                <div class="symbol">‚Ç©</div>
                <div class="symbol">‚Ç¥</div>
                <div class="symbol">‚Ç±</div>
                <div class="symbol">‚Ç£</div>
            </div>
        </div>

        <div id="chat-box"></div>

        <div id="input-container">
            <input type="text" id="input-box" placeholder="Type your message..." />
            <button class="btn" onclick="sendMessage()">Send</button>
        </div>

        <div id="conversion-container">
            <input type="number" id="amount" placeholder="Amount" />
            <select id="from-currency"></select>
            <select id="to-currency"></select>
            <button class="btn" onclick="convertCurrency()">Convert</button>
        </div>
        <div id="conversion-result"></div>
    </div>

    <!-- Historical Tab -->
    <div id="historical-tab" class="tab-content">
        <h3 style="margin-bottom: 15px;">üìä Historical Exchange Rates</h3>
        <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">Check past currency exchange rates</p>
        
        <label style="font-size: 0.9em; margin-bottom: 5px; display: block;">Select Date:</label>
        <input type="date" id="hist-date" class="date-input" max="">
        <p style="font-size:0.75em; color:#666; margin-top:5px;">
            üìÖ Real data for major currencies (USD, EUR, GBP, JPY, etc.)<br>
            üìä Estimated data for other currencies (INR, PKR, etc.)
        </p>
        
        <label style="font-size: 0.9em; margin-bottom: 5px; display: block; margin-top: 10px;">From Currency:</label>
        <select id="hist-from" class="currency-select" style="width: 100%;"></select>
        
        <label style="font-size: 0.9em; margin-bottom: 5px; display: block; margin-top: 10px;">To Currency:</label>
        <select id="hist-to" class="currency-select" style="width: 100%;"></select>
        
        <button class="btn" style="width: 100%; margin-top: 15px;" onclick="getHistoricalRate()">Get Historical Rate</button>
        
        <div id="historical-result"></div>
    </div>

    <!-- Prediction Tab -->
    <div id="prediction-tab" class="tab-content">
        <h3 style="margin-bottom: 15px;">üîÆ Future Rate Prediction</h3>
        <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">Trend-based prediction (not financial advice)</p>
        
        <label style="font-size: 0.9em; margin-bottom: 5px; display: block;">From Currency:</label>
        <select id="pred-from" class="currency-select" style="width: 100%;"></select>
        
        <label style="font-size: 0.9em; margin-bottom: 5px; display: block; margin-top: 10px;">To Currency:</label>
        <select id="pred-to" class="currency-select" style="width: 100%;"></select>
        
        <label style="font-size: 0.9em; margin-bottom: 5px; display: block; margin-top: 10px;">Days Ahead:</label>
        <input type="number" id="pred-days" class="days-input" value="7" min="1" max="30" style="width: 100%;">
        
        <button class="btn btn-secondary" style="width: 100%; margin-top: 15px;" onclick="getPrediction()">Predict Future Rate</button>
        
        <div id="prediction-result"></div>
    </div>
</div>

<script>
    const chatBox = document.getElementById('chat-box');
    const inputBox = document.getElementById('input-box');
    const conversionResult = document.getElementById('conversion-result');

    // Initialize
    window.onload = function() {
        fetchCurrencies();
        document.getElementById('hist-date').max = new Date().toISOString().split('T')[0];
    };

    // Tab switching
    function switchTab(tabName) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById(tabName + '-tab').classList.add('active');
    }

    // Fetch currencies
    async function fetchCurrencies() {
        const response = await fetch('/currencies');
        const data = await response.json();
        if (data.success) {
            populateCurrencyOptions(data.currencies);
        }
    }

    function populateCurrencyOptions(currencies) {
        const selects = ['from-currency', 'to-currency', 'hist-from', 'hist-to', 'pred-from', 'pred-to'];
        
        selects.forEach(selectId => {
            const select = document.getElementById(selectId);
            select.innerHTML = '';
            currencies.forEach(currency => {
                const option = document.createElement('option');
                option.value = currency;
                option.textContent = currency;
                select.appendChild(option);
            });
        });
    }

    // Chat
    async function sendMessage() {
        const message = inputBox.value.trim();
        if (!message) return;

        chatBox.innerHTML += `<div class="message user-message">${message}</div><div style="clear:both"></div>`;
        inputBox.value = '';
        chatBox.scrollTop = chatBox.scrollHeight;

        const response = await fetch('/learning_chat', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ message })
        });
        const data = await response.json();
        if (data.success) {
            chatBox.innerHTML += `<div class="message bot-message">${data.response}</div><div style="clear:both"></div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    }

    // Current conversion
    async function convertCurrency() {
        const amount = document.getElementById('amount').value;
        const from = document.getElementById('from-currency').value;
        const to = document.getElementById('to-currency').value;

        if (!amount || !from || !to) return;

        const response = await fetch(`/convert?amount=${amount}&base_currency=${from}&target_currency=${to}`);
        const data = await response.json();

        if (data.success) {
            conversionResult.textContent = `${amount} ${from} = ${data.result}`;
        } else {
            conversionResult.textContent = 'Conversion failed';
        }
    }

    // Historical rate
    async function getHistoricalRate() {
        const date = document.getElementById('hist-date').value;
        const from = document.getElementById('hist-from').value;
        const to = document.getElementById('hist-to').value;

        if (!date) {
            alert('Please select a date');
            return;
        }

        const resultDiv = document.getElementById('historical-result');
        resultDiv.innerHTML = '<p style="text-align:center; margin-top:15px;">‚è≥ Loading real data...</p>';

        const response = await fetch(`/historical?base_currency=${from}&target_currency=${to}&date=${date}`);
        const data = await response.json();

        if (data.success) {
            resultDiv.innerHTML = `
                <div class="result-box">
                    <h3>üìÖ ${data.date}</h3>
                    <p>1 ${data.base_currency} =</p>
                    <div class="result-value">${data.rate} ${data.target_currency}</div>
                    <p style="font-size:0.75em; color:#666; margin-top:10px;">‚úÖ ${data.source}</p>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `<p style="color: red; margin-top: 15px;">‚ùå ${data.error || 'Unable to fetch historical rate'}</p>`;
        }
    }

    // Prediction
    async function getPrediction() {
        const from = document.getElementById('pred-from').value;
        const to = document.getElementById('pred-to').value;
        const days = document.getElementById('pred-days').value;

        const resultDiv = document.getElementById('prediction-result');
        resultDiv.innerHTML = '<p style="text-align:center; margin-top:15px;">üîÆ Analyzing 30 days of real data...</p>';

        const response = await fetch(`/predict?base_currency=${from}&target_currency=${to}&days=${days}`);
        const data = await response.json();

        if (data.success) {
            const pred = data.prediction;
            const trendClass = pred.trend === 'upward' ? 'trend-up' : 'trend-down';
            const trendIcon = pred.trend === 'upward' ? 'üìà' : 'üìâ';
            const changeIcon = pred.change_percent > 0 ? '+' : '';
            
            resultDiv.innerHTML = `
                <div class="prediction-box">
                    <h3>üîÆ ${days}-Day Prediction</h3>
                    <p><strong>Current Rate:</strong> ${pred.current_rate} ${to}</p>
                    <p><strong>Predicted Rate:</strong></p>
                    <div class="result-value">${pred.predicted_rate} ${to}</div>
                    <div class="trend-indicator ${trendClass}">
                        ${trendIcon} ${pred.trend.toUpperCase()} ${pred.trend_strength.toUpperCase()}<br>
                        ${changeIcon}${pred.change_percent}% change
                    </div>
                    <div style="margin-top:15px; font-size:0.9em;">
                        <p><strong>üìä Analysis:</strong></p>
                        <p>‚Ä¢ Confidence: ${pred.confidence.toUpperCase()}</p>
                        <p>‚Ä¢ Volatility: ${pred.volatility}%</p>
                        <p>‚Ä¢ Data points: ${pred.data_points} days</p>
                        <p>‚Ä¢ Method: ${data.method}</p>
                    </div>
                    <p class="disclaimer">${data.disclaimer}</p>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `<p style="color: red; margin-top: 15px;">‚ùå ${data.error || 'Unable to generate prediction'}</p>`;
        }
    }

    // Enter key support
    inputBox.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });
</script>

</body>
</html>